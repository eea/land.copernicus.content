<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<body>
  <metal:description fill-slot="content-description" />

  <metal:content-core fill-slot="content-core">
    <metal:main_macro define-macro="content-core">

<style type="text/css">
  div[data-diazo=insitu-news-list],
  div[data-diazo=insitu-events-list] {
    display: none;
  }
  .insitu-btn-observations:hover,
  .insitu-btn-spatial-data:hover {
    text-decoration: none !important;
  }

  .btn.pressed {
    border: 2px solid #000000;
    border-bottom: 2px solid #000000 !important;
  }

  .insitu-btn-tags-container:not(.search-filters) {
    display: none;
  }

  body.template-search-by-tags .btn.btn-sm.insitu-btn-observations {
    color: #000000 !important;
  }

  body.template-search-by-tags .btn.btn-sm {
    color: #FFFFFF !important;
    margin-right: 5px;
    margin-bottom: 2px;
  }

  body.template-search-by-tags .btn.btn-sm:hover {
    text-decoration: none !important;
  }

  .btn.btn-sm.insitu-btn-observations,
  .btn.btn-sm.insitu-btn-spatial-data {
    padding: 6px 10px !important;
    font-size: 12px !important;
  }

  div.search-item {
    padding-bottom: 20px;
    border-bottom: 1px solid #DDDDDD;
    margin-bottom: 10px;
  }
</style>

<div id="search-app" class="container"
     ng-app="searchApp" ng-controller="searchController as app">
  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>

      <h1>Search by tags</h1>
      <p>
        Search results:
        <span tal:replace="python:view.do_search().get('results')"></span>
      </p>

      <!-- SEARCH RESULTS -->
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div class="search-item" ng-repeat="item in app.get_results()">
            <div class="item">
              <a href="{{item.url}}" target="_blank">
                <h3>
                  {{item.title}}
                </h3>
              </a>
              <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                Nullam mollis ut lacus id placerat.
                Nullam mollis, nisl eget luctus tincidunt, sem lectus
                efficitur urna, quis aliquet mi tellus id nibh.
                Sed pharetra iaculis lacinia. Phasellus sagittis, sem vel
                gravida mattis, mauris lacus posuere odio, sit amet aliquam
                nunc urna eu quam. Vestibulum sollicitudin ligula eget dui
                auctor, a malesuada urna molestie.
                Vivamus in massa mattis, molestie risus ut, hendrerit
                <a href="{{item.url}}" target="_blank">
                  [...]
                </a>
              </p>
              <a href
                 ng-repeat="tag in app.get_tags_info(item.tags)"
                 ng-click="app.toggle_tag(tag.title)"
                 class="{{tag.tag_class}} {{app.is_pressed(tag.title)}}">
                {{tag.title}}
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- SEARCH CRITERIA -->
      <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6"
             ng-repeat="tag in app.get_tags(1)">
          <a href class="{{tag.btn_class}} {{app.is_pressed(tag.title)}}"
             ng-click="app.toggle_tag(tag.title)">
            <img ng-src="./{{tag.id}}-icon.png" alt="{{tag.title}}">
            <br>
            <span class="text text-uppercase">{{tag.title}}</span>
          </a>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <!-- Insitu Tags -->
          <div class="insitu-btn-tags-container search-filters text-center">
            <div id="insitu-tags-1">
              <a href
                 ng-repeat="tag in app.get_tags(2)"
                 ng-click="app.toggle_tag(tag.title)"
                 class="{{tag.btn_class}} {{app.is_pressed(tag.title)}}">
                {{tag.title}}
              </a>
            </div>
            <div id="insitu-tags-2">
              <a href
                 ng-repeat="tag in app.get_tags(3)"
                 ng-click="app.toggle_tag(tag.title)"
                 class="{{tag.btn_class}} {{app.is_pressed(tag.title)}}">
                {{tag.title}}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
angular.module('searchApp', [])
  .controller('searchController', function() {
    var app = this;

    app.tags = [
      {
        category: 1,
        title: 'Observations',
        id: 'observations',
        tag_class: 'btn btn-default btn-sm insitu-btn-observations',
        btn_class: 'btn btn-default btn-block insitu-btn-observations'
      },
      {
        category: 1,
        title: 'Spatial Data',
        id: 'spatial-data',
        tag_class: 'btn btn-default btn-sm insitu-btn-spatial-data',
        btn_class: 'btn btn-default btn-block insitu-btn-spatial-data'
      },
      {
        category: 2,
        title: 'Policy',
        id: 'policy',
        tag_class: 'btn btn-default btn-sm insitu-btn-policy',
        btn_class: 'btn btn-default insitu-btn-policy'
      },
      {
        category: 2,
        title: 'Agreements',
        id: 'agreements',
        tag_class: 'btn btn-default btn-sm insitu-btn-agreements',
        btn_class: 'btn btn-default insitu-btn-agreements'
      },
      {
        category: 2,
        title: 'Infrastructure',
        id: 'infrastructure',
        tag_class: 'btn btn-default btn-sm insitu-btn-infrastructure',
        btn_class: 'btn btn-default insitu-btn-infrastructure'
      },
      {
        category: 2,
        title: 'Open Data',
        id: 'open-data',
        tag_class: 'btn btn-default btn-sm insitu-btn-open-data',
        btn_class: 'btn btn-default insitu-btn-open-data'
      },
      {
        category: 3,
        title: 'Land',
        id: 'land',
        tag_class: 'btn btn-default btn-sm insitu-btn-land',
        btn_class: 'btn btn-default insitu-btn-land'
      },
      {
        category: 3,
        title: 'Marine',
        id: 'marine',
        tag_class: 'btn btn-default btn-sm insitu-btn-marine',
        btn_class: 'btn btn-default insitu-btn-marine'
      },
      {
        category: 3,
        title: 'Atmosphere',
        id: 'atmosphere',
        tag_class: 'btn btn-default btn-sm insitu-btn-atmosphere',
        btn_class: 'btn btn-default insitu-btn-atmosphere'
      },
      {
        category: 3,
        title: 'Emergency',
        id: 'emergency',
        tag_class: 'btn btn-default btn-sm insitu-btn-emergency',
        btn_class: 'btn btn-default insitu-btn-emergency'
      },
      {
        category: 3,
        title: 'Security',
        id: 'security',
        tag_class: 'btn btn-default btn-sm insitu-btn-security',
        btn_class: 'btn btn-default insitu-btn-security'
      },
      {
        category: 3,
        title: 'Climate Change',
        id: 'climate-change',
        tag_class: 'btn btn-default btn-sm insitu-btn-climate-change',
        btn_class: 'btn btn-default insitu-btn-climate-change'
      }
    ]
    app.tagsMappedByTitle = {};
    app.tags.forEach(function (c) { app.tagsMappedByTitle[c.title] = c; });

    app.items = [
      {
        id: '01',
        title: 'Title here 1',
        url: 'http://www.google.com',
        tags: ['Security', 'Emergency', 'Observations', 'Atmosphere']
      },
      {
        id: '02',
        title: 'Title here 2',
        url: 'http://www.google.com',
        tags: ['Spatial Data', 'Security', 'Atmosphere']
      },
      {
        id: '03',
        title: 'Title here 3',
        url: 'http://www.google.com',
        tags: ['Climate Change', 'Atmosphere']
      },
      {
        id: '04',
        title: 'Title here 4',
        url: 'http://www.google.com',
        tags: ['Security', 'Emergency', 'Observations', 'Atmosphere']
      },
      {
        id: '05',
        title: 'Title here 5',
        url: 'http://www.google.com',
        tags: ['Spatial Data', 'Security', 'Atmosphere']
      },
      {
        id: '06',
        title: 'Title here 6',
        url: 'http://www.google.com',
        tags: ['Climate Change', 'Marine']
      },
      {
        id: '07',
        title: 'Title here 7',
        url: 'http://www.google.com',
        tags: ['Security', 'Emergency', 'Observations', 'Marine']
      },
      {
        id: '08',
        title: 'Title here 8',
        url: 'http://www.google.com',
        tags: ['Spatial Data', 'Security', 'Marine']
      },
      {
        id: '09',
        title: 'Title here 9',
        url: 'http://www.google.com',
        tags: ['Climate Change', 'Marine']
      },
      {
        id: '10',
        title: 'Title here 10',
        url: 'http://www.google.com',
        tags: ['Security', 'Emergency', 'Observations', 'Marine']
      },
      {
        id: '11',
        title: 'Title here 11',
        url: 'http://www.google.com',
        tags: ['Spatial Data', 'Security', 'Land']
      },
      {
        id: '12',
        title: 'Title here 12',
        url: 'http://www.google.com',
        tags: ['Climate Change', 'Land']
      },
      {
        id: '13',
        title: 'Title here 13',
        url: 'http://www.google.com',
        tags: ['Security', 'Emergency', 'Observations', 'Land']
      },
      {
        id: '14',
        title: 'Title here 14',
        url: 'http://www.google.com',
        tags: ['Spatial Data', 'Security', 'Open Data']
      },
      {
        id: '15',
        title: 'Title here 15',
        url: 'http://www.google.com',
        tags: ['Climate Change', 'Open Data']
      },
      {
        id: '16',
        title: 'Title here 16',
        url: 'http://www.google.com',
        tags: ['Security', 'Emergency', 'Observations', 'Infrastructure']
      },
      {
        id: '17',
        title: 'Title here 17',
        url: 'http://www.google.com',
        tags: ['Spatial Data', 'Security', 'Agreements', 'Infrastructure']
      },
      {
        id: '18',
        title: 'Title here 18',
        url: 'http://www.google.com',
        tags: ['Climate Change', 'Policy']
      }
    ];

    app.selected_tags = [];

    app.superset_includes_subset = function arrayContainsArray (superset, subset) {
      // Return true if all values in subset exist in superset
      return subset.every(function (value) {
        return (superset.indexOf(value) >= 0);
      });
    }

    app.item_has_tags = function(item, tags) {
      // Return true if all tags are present in item's tags
      return app.superset_includes_subset(item.tags, tags);
    }

    app.get_results = function() {
      // Filter items by selected tags
      result = [];
      angular.forEach(app.items, function(an_item) {
        if(app.item_has_tags(an_item, app.selected_tags)) {
          result.push(an_item);
        }
      });
      return result;
    }

    app.get_tags = function(category) {
      // Return tags by given category
      result = [];
      angular.forEach(app.tags, function(a_tag) {
        if(a_tag.category == category) {
          result.push(a_tag);
        }
      });
      return result;
    }

    app.get_tag_info = function(tag_name) {
      // Return tag info by given title
      return app.tagsMappedByTitle[tag_name];
    }

    app.get_tags_info = function(tags) {
      // Input: array of strings (tags titles)
      // Output: array of tags (info)
      result = [];
      angular.forEach(tags, function(tag_name) {
        result.push(app.get_tag_info(tag_name));
      });
      return result;
    }

    app.tag_is_selected = function(tag_name) {
      // Return true if the tag is selected as criteria for search
      var result = false;
      angular.forEach(app.selected_tags, function(a_tag_name) {
        if(a_tag_name == tag_name) {
          result = true;
        }
      });
      return result;
    }

    app.is_pressed = function(tag_name) {
      // Return 'pressed' or '' to be used as class name for btn
      if(app.tag_is_selected(tag_name)) {
        return 'pressed';
      }
      return '';
    }

    app.add_tag = function(tag_name) {
      // Add a given tag in the selected tags
      app.selected_tags.push(tag_name);
    }

    app.remove_tag = function(tag_name) {
      // Remove a given tag from the selected tags
      app.selected_tags.splice(app.selected_tags.indexOf(tag_name), 1);
    }

    app.toggle_tag = function(tag_name) {
      // Select or deselect a given tag from search criteria
      if(app.tag_is_selected(tag_name)) {
        app.remove_tag(tag_name);
      } else {
        app.add_tag(tag_name);
      }
    }

  });
</script>



    </metal:main_macro>
  </metal:content-core>
</body>
</html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<body>
  <metal:description fill-slot="content-description" />

  <metal:content-core fill-slot="content-core">
    <metal:main_macro define-macro="content-core">

<style type="text/css">
  div[data-diazo=insitu-news-list],
  div[data-diazo=insitu-events-list] {
    display: none;
  }
  .insitu-btn-observations:hover,
  .insitu-btn-spatial-data:hover {
    text-decoration: none !important;
  }

  .btn.pressed {
    border: 2px solid #000000;
    border-bottom: 2px solid #000000 !important;
  }

  .insitu-btn-tags-container:not(.search-filters) {
    display: none;
  }
</style>

<div id="search-app" class="container"
     ng-app="searchApp" ng-controller="searchController as app">
  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>

      <h1>Search by tags</h1>
      <p>
        Search results:
        <span tal:replace="python:view.do_search().get('results')"></span>
      </p>

      <!-- SEARCH RESULTS -->
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div class="search-item" ng-repeat="item in app.get_results()">
            <div class="item">
              {{item.id}}
              <a href="{{item.url}}" target="_blank">{{item.title}}</a>
              {{item.tags}}
            </div>
          </div>
        </div>
      </div>

      <!-- SEARCH CRITERIA -->
      <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
          <a href class="btn btn-default btn-block insitu-btn-observations {{app.is_pressed('Observations')}}"
             ng-click="app.toggle_tag('Observations')">
            <img src="./observation-icon.png" alt="Observations">
            <br>
            <span class="text">OBSERVATIONS</span>
          </a>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
          <a href class="btn btn-default btn-block insitu-btn-spatial-data {{app.is_pressed('Spatial Data')}}"
             ng-click="app.toggle_tag('Spatial Data')">
            <img src="./spatial-data-icon.png" alt="Spatial data">
            <br>
            <span class="text">SPATIAL DATA</span>
          </a>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <!-- Insitu Tags -->
          <div class="insitu-btn-tags-container search-filters text-center">
            <div id="insitu-tags-1">
              <a href ng-click="app.toggle_tag('Policy')"
                 class="btn btn-default insitu-btn-policy {{app.is_pressed('Policy')}}">
                Policy
              </a>
                <a href ng-click="app.toggle_tag('Agreements')"
                 class="btn btn-default insitu-btn-agreements {{app.is_pressed('Agreements')}}">
                Agreements
              </a>
              <a href ng-click="app.toggle_tag('Infrastructure')"
                 class="btn btn-default insitu-btn-infrastructure {{app.is_pressed('Infrastructure')}}">
                Infrastructure
              </a>
              <a href ng-click="app.toggle_tag('Open Data')"
                 class="btn btn-default insitu-btn-open-data {{app.is_pressed('Open Data')}}">
                Open Data
              </a>
            </div>
            <div id="insitu-tags-2">
              <a href ng-click="app.toggle_tag('Land')"
                 class="btn btn-default insitu-btn-land {{app.is_pressed('Land')}}">
                Land
              </a>
              <a href ng-click="app.toggle_tag('Marine')"
                 class="btn btn-default insitu-btn-marine {{app.is_pressed('Marine')}}">
                Marine
              </a>
              <a href ng-click="app.toggle_tag('Atmosphere')"
                 class="btn btn-default insitu-btn-atmosphere {{app.is_pressed('Atmosphere')}}">
                Atmosphere
              </a>
              <a href ng-click="app.toggle_tag('Emergency')"
                 class="btn btn-default insitu-btn-emergency {{app.is_pressed('Emergency')}}">
                Emergency
              </a>
              <a href ng-click="app.toggle_tag('Security')"
                 class="btn btn-default insitu-btn-security {{app.is_pressed('Security')}}">
                Security
              </a>
              <a href ng-click="app.toggle_tag('Climate Change')"
                 class="btn btn-default insitu-btn-climate-change {{app.is_pressed('Climate Change')}}">
                Climate Change
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
angular.module('searchApp', [])
  .controller('searchController', function() {
    var app = this;

    app.items = [
      {
        id: '01',
        title: 'Title here 1',
        url: 'http://www.google.com',
        tags: ['Security', 'Emergency', 'Observations']
      },
      {
        id: '02',
        title: 'Title here 2',
        url: 'http://www.google.com',
        tags: ['Spatial Data', 'Security']
      },
      {
        id: '03',
        title: 'Title here 3',
        url: 'http://www.google.com',
        tags: ['Climate Change']
      }
    ];

    app.selected_tags = ['Security'];

    app.superset_includes_subset = function arrayContainsArray (superset, subset) {
      // Return true if all values in subset exist in superset
      return subset.every(function (value) {
        return (superset.indexOf(value) >= 0);
      });
    }

    app.item_has_tags = function(item, tags) {
      // Return true if all tags are present in item's tags
      return app.superset_includes_subset(item.tags, tags);
    }

    app.get_results = function() {
      // Filter items by selected tags
      result = [];
      angular.forEach(app.items, function(an_item) {
        if(app.item_has_tags(an_item, app.selected_tags)) {
          result.push(an_item);
        }
      });
      return result;
    }

    app.tag_is_selected = function(tag_name) {
      // Return true if the tag is selected as criteria for search
      var result = false;
      angular.forEach(app.selected_tags, function(a_tag_name) {
        if(a_tag_name == tag_name) {
          result = true;
        }
      });
      return result;
    }

    app.is_pressed = function(tag_name) {
      // Return 'pressed' or '' to be used as class name for btn
      if(app.tag_is_selected(tag_name)) {
        return 'pressed';
      }
      return '';
    }

    app.add_tag = function(tag_name) {
      // Add a given tag in the selected tags
      app.selected_tags.push(tag_name);
    }

    app.remove_tag = function(tag_name) {
      // Remove a given tag from the selected tags
      app.selected_tags.splice(app.selected_tags.indexOf(tag_name), 1);
    }

    app.toggle_tag = function(tag_name) {
      // Select or deselect a given tag from search criteria
      if(app.tag_is_selected(tag_name)) {
        app.remove_tag(tag_name);
      } else {
        app.add_tag(tag_name);
      }
      alert(app.selected_tags);
    }

  });
</script>



    </metal:main_macro>
  </metal:content-core>
</body>
</html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<body>
  <metal:styleslot fill-slot="style_slot">
    <link rel="stylesheet" type="text/css" href="${portal_url}/++resource++land.copernicus.content.static/lib/jquery.dataTables.min.css" />
  </metal:styleslot>

  <metal:javascriptslot fill-slot="javascript_head_slot">
    <script defer type="text/javascript" language="javascript" src="${portal_url}/++resource++land.copernicus.content.static/lib/jquery.dataTables.min.js"></script>
  </metal:javascriptslot>

  <metal:description fill-slot="content-description" />

  <metal:content-core fill-slot="content-core">
    <metal:main_macro define-macro="content-core">
      <div class="users-statistics-container"
           tal:define="reports python:view.reports">
        <h2 i18n:translate="">Users Statistics</h2>
        <p>
          Check the existing reports first. If the info is missing you can
          schedule a report for needed time period.
        </p>

        <form method="post">
          <div class="form-group">
            <label for="start-date">Start date</label>
            <input type="date" name="start-date" min="2010-01-01" required />
            <p class="help-block">Start date for your report</p>
          </div>

          <div class="form-group">
            <label for="end-date">End date</label>
            <input type="date" name="end-date" min="2010-01-01" required />
            <p class="help-block">End date for your report</p>
          </div>

          <button name="submit" type="submit" class="btn btn-default">
            Generate report
          </button>
        </form>

        <h2>Reports</h2>
        <p>Check requested reports (content and status) here.</p>
        <table class="table table-bordered user-stats-reports">
          <thead>
            <tr>
              <th>Time period</th>
              <th>Active</th>
              <th>New</th>
              <th>Total</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tal:reports tal:repeat="period_title python:sorted(reports.keys(), reverse=True)"
                         tal:condition="python:reports is not None">
              <tr tal:define="report python: reports.get(period_title)">
                <td tal:content="python:period_title">
                  2010/01/01-2010/01/31
                </td>
                <td tal:content="python:report.get('active', 'N/A')">
                  23
                </td>
                <td tal:content="python:report.get('new', 'N/A')">
                  12
                </td>
                <td tal:content="python:report.get('total', 'N/A')">
                  432
                </td>
                <td tal:content="python:report.get('last_update', 'N/A')">
                  pending or DateTime
                </td>
              </tr>
            </tal:reports>
          </tbody>
        </table>

        <form method="post">
          <button name="refresh" type="submit" class="btn btn-default">
            Refresh table
          </button>
        </form>
      </div>

      <script>
        $(document).ready(function() {
          $('table.user-stats-reports').DataTable({
            "order": [[ 4, "desc" ]]
          });
        });
      </script>
    </metal:main_macro>
  </metal:content-core>
</body>
</html>

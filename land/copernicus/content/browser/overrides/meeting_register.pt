<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone.app.event">

<head>
  <!-- TODO get rid of CDN -->
  <metal:styleslot fill-slot="style_slot">
    <link rel="stylesheet" type="text/css"
      tal:attributes="href string:${portal_url}/++resource++land.copernicus.content.static/meeting/register.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/build/css/bootstrap-datetimepicker.css" />
  </metal:styleslot>
  <metal:javascriptslot fill-slot="javascript_head_slot">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript"
      tal:attributes="src string:${portal_url}/++resource++land.copernicus.content.static/meeting/register.js"></script>
  </metal:javascriptslot>
</head>
<body>

<metal:fill fill-slot="column_two_slot"></metal:fill>

<metal:title fill-slot="content-title">
  <h1 class="documentFirstHeading text-center land-title"><span tal:replace="context/title_or_id"></span> - registration</h1>
</metal:title>

<metal:content-core fill-slot="content-core"
  tal:define="show_register_form python:request.get('form', '') == 'register'">
<metal:block define-macro="content-core">

<div class="meeting-info-container">
  <p class="text-center">
    <b>When:</b>
    <span tal:define="start_tzname context/timezone;
          start_utcdelta python:context.start.tzinfo.utcoffset(context.start);
          start_utcoffset python:(start_utcdelta.days*86400+start_utcdelta.seconds)*100/60/60;">
      <span tal:replace="structure python:view.formatted_date(context)" ></span>
    </span>
  </p>

  <p class="text-center">
    <b>Where:</b>
    <span tal:define="location context/location"
          tal:condition="python:context.location and (context.is_webminar() is not True)">
      <span class="location">
        <a tal:content="location"
           tal:attributes="href string:http://maps.google.com?q=$location"
           title="View on map" itemprop="location" >Location</a>
      </span>
    </span>
  </p>

</div>

<tal:anon condition="view/is_anon">
<p>
  You have to log in to register to this event.
  If you have EIONET account or account on https://land.copernicus.eu please
  type your username and password in the form on the left.
  Otherwise, please use the button on the right to create a new account on
  https://land.copernicus.eu.
</p>

<div id="choice" tal:attributes="style python:'display: none' if show_register_form else ''">
  <div class="login" tal:define="message python:options.get('login_message', None)">
    <metal:message define-macro="message">
      <tal:message tal:condition="message">
        <div tal:attributes="class string:message ${message/type}"
          onclick="$(this).fadeOut()">
          <div tal:content="message/text"></div>
        </div>
      </tal:message>
    </metal:message>
    <form id="form-login" action="./register" name="login" method="POST" class="register-form">
      <div class="register-form-fields">
        <metal:field define-macro="field">
          <div class="field">
            <div class="field-label">
              <metal:field-label define-slot="label">
                <label for="f_username">User Name</label>
              </metal:field-label>
            </div>
            <div class="field-body">
              <metal:field-body define-slot="body">
                <input id="f_username" type="text" name="__ac_name" required />
              </metal:field-body>
            </div>
          </div>
        </metal:field>
        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>Password</label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="password" name="__ac_password" required />
          </metal:body>
        </metal:field>
        <div class="buttons">
          <span>
            <button type="submit" name="submit.login" class="btn btn-default">LOGIN</button>
            <a href="./">Back to meeting</a>
          </span>
          <span>
            <a href="./mail_password_form?userid=">Forgot password?</a>
            <span class="info" title="Will not work for Eionet users. If you have an Eionet account you will need to contact the Eionet Helpdesk to reset your password.">&#x24d8;</span>
          </span>
        </div>
      </div>
    </form>
  </div>
  <div class="register">
    <a href="./register?form=register" class="choice-button"
      onclick="meeting.show_registration();return false">CREATE NEW</a>
  </div>
</div>


<form id="form-register" class="register-form" tal:attributes="style python:'display: none' if not show_register_form else ''"
  action="./register?form=register" name="register" method="POST" class="register-form"
  tal:define="message python:options.get('register_message', None); fields python:options.get('fields', {});">

  <h2 class="land-title">Personal information</h2>

  <metal:message use-macro="template/macros/message" />
  <div class="register-form-fields">
    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Name<span class="required"></span></label>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="text" name="first_name" required
          tal:attributes="value python:fields.get('first_name', '')" />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Family name<span class="required"></span></label>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="text" name="last_name" required
          tal:attributes="value python:fields.get('last_name', '')" />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Organisation<span class="required"></span></label>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="text" name="organisation" required
          tal:attributes="value python:fields.get('organisation', '')" />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Position<span class="required"></span></label>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="text" name="position" required
          tal:attributes="value python:fields.get('position', '')" />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Country<span class="required"></span></label>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="text" name="country" required
          tal:attributes="value python:fields.get('country', '')" />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>City<span class="required"></span></label>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="text" name="address" required
          tal:attributes="value python:fields.get('address', '')" />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Email address<span class="required"></span></label>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="email" name="email" required
          tal:attributes="value python:fields.get('email', '')" />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Phone no</label>
      </metal:label>
      <metal:body fill-slot="body">
        <textarea rows="5" cols="30" name="phone_numbers:lines"
          tal:content="python:'\n'.join(fields.get('phone_numbers', []))"></textarea>
      </metal:body>
    </metal:field>
  </div>

  <h2 class="land-title">Login details</h2>

  <div class="register-form-fields">
    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>User Name<span class="required"></span></label>
        <p class="formHelp">
          The username must contain only ASCII letters [a..z] or [A..Z].
        </p>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="text" name="username" required
          tal:attributes="value python:fields.get('username', '')" />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Password<span class="required"></span></label>
        <p class="formHelp">
          The password must be at least 5 characters long.
        </p>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="password" name="pw1" required />
      </metal:body>
    </metal:field>

    <metal:field use-macro="template/macros/field">
      <metal:label fill-slot="label">
        <label>Password confirmation<span class="required"></span></label>
      </metal:label>
      <metal:body fill-slot="body">
        <input type="password" name="pw2" required />
      </metal:body>
    </metal:field>

    <button type="submit" name="submit.register" class="btn btn-default">Register new account</button>
    <a href="./register" onclick="meeting.show_choice();return false">Cancel</a>
  </div>
</form>
<script>
  $(document).on("ready", function(){
    meeting.setup_pages()
  });
</script>

</tal:anon>

<tal:member tal:condition="not:view/is_anon"
     tal:define="is_registered python:context.is_registered();
                 options python:view.prefill_form_data()">

  <tal:message-created define="message python:options.get('created_message', None)">
    <metal:message use-macro="template/macros/message" />
  </tal:message-created>
  <tal:message-login define="message python:options.get('login_message', None)">
    <metal:message use-macro="template/macros/message" />
  </tal:message-login>
  <tal:signup condition="not:is_registered" tal:define="fields python:options.get('fields', {});">
    <p>Hello, <span tal:replace="python:user.getProperty('fullname')"></span>, please validate and complete the following information to register to this event:</p>

    <tal:message-signup define="message python:options.get('signup_message', None)">
      <metal:message use-macro="template/macros/message" />
    </tal:message-signup>

    <form id="form-signup" action="./register" name="signup" method="POST" class="register-form">
      <div class="register-form-fields">

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>Name<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="first_name" required
              tal:attributes="value python:fields.get('first_name', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>Family name<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="last_name" required
              tal:attributes="value python:fields.get('last_name', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>Organisation<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="organisation" required
              tal:attributes="value python:fields.get('organisation', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>Position<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="position" required
              tal:attributes="value python:fields.get('position', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>Country<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="country" required
              tal:attributes="value python:fields.get('country', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>City<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="address" required
              tal:attributes="value python:fields.get('address', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>Email address<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="email" name="email" required
              tal:attributes="value python:fields.get('email', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label>Phone no</label>
          </metal:label>
          <metal:body fill-slot="body">
            <textarea rows="5" cols="30" name="phone_numbers:lines"
              tal:content="python:'\n'.join(fields.get('phone_no', []))"></textarea>
          </metal:body>
        </metal:field>
        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label for="f_role">I would like to attend the event in the capacity of<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <select id="f_role" name="role" required>
              <option></option>
              <tal:role repeat="option view/role_options">
                <option tal:attributes="
                  value python:option[0];
                  selected python:'selected' if option[0] == fields.get('role') else ''"
                  tal:content="python:option[1]"></option>
              </tal:role>
            </select>
            <input class="other" type="text" id="f_role_other"
                   name="role_other"
                   tal:attributes="value python:fields.get('role_other', '')"
                   placeholder="please specify"
                   />
            <span>&nbsp;</span>
            <script>
              $(document).on("ready", function() {
                meeting.widget_other('#f_role', '#f_role_other')
              });
            </script>
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field" tal:condition="context/need_e_pass">
          <metal:label fill-slot="label">
            <label for="f_date_of_birth">DATE OF BIRTH<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="date_of_birth" required
              tal:attributes="value python:fields.get('date_of_birth', '')" />

            <script type="text/javascript">
              $(function() {
                $('input[name="date_of_birth"]').datetimepicker({
                  format: 'DD-MM-YYYY'
                });
              });
            </script>
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field" tal:condition="context/need_e_pass">
          <metal:label fill-slot="label">
            <label for="f_nationality">NATIONALITY<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="nationality" required
              tal:attributes="value python:fields.get('nationality', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field" tal:condition="context/need_e_pass">
          <metal:label fill-slot="label">
            <label for="f_id_card_nbr">ID CARD NBR<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="id_card_nbr" required
              tal:attributes="value python:fields.get('id_card_nbr', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field" tal:condition="context/need_e_pass">
          <metal:label fill-slot="label">
            <label for="f_id_valid_date">ID VALID DATE</label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="id_valid_date" required
              tal:attributes="value python:fields.get('id_valid_date', '')" />

            <script type="text/javascript">
              $(function() {
                $('input[name="id_valid_date"]').datetimepicker({
                  format: 'DD-MM-YYYY'
                });
              });
            </script>
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field" tal:condition="context/need_e_pass">
          <metal:label fill-slot="label">
            <label for="f_parking">PARKING<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <select id="f_parking" name="parking" required>
              <option></option>
              <option>Yes</option>
              <option>No</option>
            </select>

            <script type="text/javascript">
              $(function() {
                function car_id_make_required() {
                  var $car_id_field = $("input[name='car_id']");
                  var $car_id_container = $car_id_field.parent().parent();
                  $car_id_field.attr('required');
                  $car_id_container.show();
                }

                function car_id_make_not_required() {
                  var $car_id_field = $("input[name='car_id']");
                  var $car_id_container = $car_id_field.parent().parent();
                  $car_id_field.removeAttr('required');
                  $car_id_container.hide();
                }

                $('#f_parking').bind('change', function () {
                  var option = $(this).find(":selected").text();
                  if(option == "Yes") {
                    car_id_make_required();
                  } else {
                    car_id_make_not_required();
                  }
                });
                $('#f_parking').trigger('change');
              });
            </script>
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field" tal:condition="context/need_e_pass">
          <metal:label fill-slot="label">
            <label for="f_car_id">CAR ID<span class="required"></span></label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="text" name="car_id" required
              tal:attributes="value python:fields.get('car_id', '')" />
          </metal:body>
        </metal:field>

        <metal:field use-macro="template/macros/field">
          <metal:label fill-slot="label">
            <label for="f_disclaimer">
              I accept <a href="/terms-of-use" target="_blank">privacy policy and terms of use</a> of this website
              <span class="required advanced"></span>
            </label>
          </metal:label>
          <metal:body fill-slot="body">
            <input type="checkbox" name="disclaimer" required
              tal:attributes="value python:fields.get('disclaimer', '')" />
          </metal:body>
        </metal:field>

        <div class="buttons">
          <span>
            <button type="submit" name="submit.signup" class="btn btn-default">Register to this meeting</button>
            <a href="./">Cancel</a>
          </span>
        </div>
      </div>
    </form>
  </tal:signup>
  <tal:registered tal:condition="is_registered">
    <tal:message-signup define="message python:options.get('signup_message', None)">
      <metal:message use-macro="template/macros/message" />
    </tal:message-signup>
    <p>Your registration request has been sent to event organisers. As soon as your registration is confirmed you will receive a notification e-mail.</p>
    <a tal:attributes="href context/absolute_url">Return to the meeting page</a>
  </tal:registered>

</tal:member>

</metal:block>
</metal:content-core>

</body>
</html>
